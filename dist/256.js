"use strict";(self.webpackChunkslack_clone=self.webpackChunkslack_clone||[]).push([[256],{5256:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var a=n(7294),l=n(9498),o=n(5977),r=n(5767),c=n(3564),i=n(2309),s=n(2545),u=n(8678),f=n(9669),d=n.n(f),p=n(8667),h=n(2951),g=n(9250),m=n(1574);(0,m.Z)("div",{target:"e1yi8ua22"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),(0,m.Z)("header",{target:"e1yi8ua21"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"});var v=(0,m.Z)("div",{target:"e1yi8ua20"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"});function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,l,o=[],r=!0,c=!1;try{for(n=n.call(e);!(r=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);r=!0);}catch(e){c=!0,l=e}finally{try{r||null==n.return||n.return()}finally{if(c)throw l}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}const b=function(){var e,t,n=(0,o.UO)(),f=n.workspace,m=n.channel,w=(0,r.ZP)("/api/users",c.Z).data,b=y((0,u.Z)(""),3),k=b[0],x=b[1],C=b[2],S=(0,r.ZP)("/api/workspaces/".concat(f,"/channels/").concat(m),c.Z).data,T=(0,r.g_)((function(e){return"/api/workspaces/".concat(f,"/channels/").concat(m,"/chats?perPage=20&page=").concat(e+1)}),c.Z),_=T.data,E=T.mutate,Z=T.revalidate,A=T.setSize,D=(0,r.ZP)(w?"/api/workspaces/".concat(f,"/channels/").concat(m,"/members"):null,c.Z).data,I=y((0,h.Z)(f),1)[0],j=0===(null==_||null===(e=_[0])||void 0===e?void 0:e.length)||_&&(null===(t=_[_.length-1])||void 0===t?void 0:t.length)<20||!1,z=(0,a.useRef)(null),B=y((0,a.useState)(!1),2),F=B[0],U=B[1],O=y((0,a.useState)(!1),2),P=O[0],W=O[1],M=(0,a.useCallback)((function(e){if(e.preventDefault(),console.log(k),null!=k&&k.trim()&&_&&S){var t=k;E((function(e){var n;return null==e||e[0].unshift({id:((null===(n=_[0][0])||void 0===n?void 0:n.id)||0)+1,content:t,UserId:w.id,User:w,ChannelId:S.id,Channel:S,createdAt:new Date}),e}),!1).then((function(){var e;C(""),null===(e=z.current)||void 0===e||e.scrollToBottom()})),d().post("/api/workspaces/".concat(f,"/channels/").concat(m,"/chats"),{content:k}).then((function(){Z()})).catch(console.error)}}),[k,_,w,S,f,m]),H=(0,a.useCallback)((function(e){e.Channel.name===m&&(e.content.startsWith("uploads\\")||e.content.startsWith("uploads/")||e.UserId!==(null==w?void 0:w.id))&&E((function(t){return null==t||t[0].unshift(e),t}),!1).then((function(){var e;z.current&&z.current.getScrollHeight()<z.current.getClientHeight()+z.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=z.current)||void 0===e?void 0:e.getValues()),setTimeout((function(){var e;null===(e=z.current)||void 0===e||e.scrollToBottom()}),50))}))}),[m,w]);(0,a.useEffect)((function(){return null==I||I.on("message",H),function(){null==I||I.off("message",H)}}),[I,H]),(0,a.useEffect)((function(){1===(null==_?void 0:_.length)&&(console.log("toBottomWhenLoaded",z.current),setTimeout((function(){var e;console.log("scrollbar",z.current),null===(e=z.current)||void 0===e||e.scrollToBottom()}),500))}),[_]);var N=(0,a.useCallback)((function(){U(!0)}),[]),R=(0,a.useCallback)((function(){U(!1)}),[]);(0,a.useCallback)((function(e){var t=new FormData;if(e.target.files)for(var n=0;n<e.target.files.length;n++){var a=e.target.files[n].getAsFile();console.log("... file["+n+"].name = "+a.name),t.append("image",a)}d().post("/api/workspaces/".concat(f,"/channels/").concat(m,"/images"),t).then((function(){}))}),[]),(0,a.useEffect)((function(){localStorage.setItem("".concat(f,"-").concat(m),(new Date).getTime().toString())}),[f,m]);var L=(0,a.useCallback)((function(e){e.preventDefault(),console.log(e);var t=new FormData;if(e.dataTransfer.items){for(var n=0;n<e.dataTransfer.items.length;n++)if(console.log(e.dataTransfer.items[n]),"file"===e.dataTransfer.items[n].kind){var a=e.dataTransfer.items[n].getAsFile();console.log(e,".... file["+n+"].name = "+a.name),t.append("image",a)}}else for(var l=0;l<e.dataTransfer.files.length;l++)console.log(e,"... file["+l+"].name = "+e.dataTransfer.files[l].name),t.append("image",e.dataTransfer.files[l]);d().post("/api/workspaces/".concat(f,"/channels/").concat(m,"/images"),t).then((function(){W(!1),localStorage.setItem("".concat(f,"-").concat(m),(new Date).getTime().toString())}))}),[f,m]),V=(0,a.useCallback)((function(e){e.preventDefault(),console.log(e),W(!0)}),[]);if(!w||!w)return null;var $=(0,p.Z)(_?_.flat().reverse():[]);return a.createElement(l.W2,{onDrop:L,onDragOver:V},a.createElement(l.h4,null,a.createElement("span",null,"#",m),a.createElement("div",{style:{display:"flex",flex:1,justifyContent:"flex-end",alignItems:"center"}},a.createElement("span",null,null==D?void 0:D.length),a.createElement("button",{onClick:N,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},a.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),a.createElement(s.Z,{chatSections:$,ref:z,setSize:A,isReachingEnd:j}),a.createElement(i.Z,{chat:k,onChangeChat:x,onSubmitForm:M}),a.createElement(g.Z,{show:F,onCloseModal:R,setShowInviteChannelModal:U}),P&&a.createElement(v,null,"업로드!"))}}}]);